@page "/contractsummary/{TransactionID:guid}"
@inject NavigationManager NavigationManager
@inject IQuestionSimulationDisplayService SimulationDisplayService
@inject AuthenticationStateProvider AuthenticationStateProvider

<div class="card">
    <div class="card-body">
        <VezaVITabControl>
            <VezaVITab Caption="Contract Summary">
                @if (model != null)
                {
                    <p>Customer Name: @model.CustomerName</p>
                    <p>Generated By User: @model.GeneratedByUser</p>
                    <p>Generated On: @model.Date.ToString("dd-MMM-yyyy")</p>
                    <hr />
                    <h5>Questions</h5>
                    int counter = 1;
                    foreach (var q in model.Questions)
                    {
                        <p>
                            Question @counter: @q.Question<br />
                            Answer: @q.Answer
                        </p>
                        counter++;
                    }
                    if (model.DataFields.Count > 0)
                    {
                        <h5>Data Fields</h5>
                        foreach (var q in model.DataFields)
                        {
                            if (model.Status == ContractHistoryStatus.Saved)
                            {
                                <p>
                                    @q.DataField: @q.Value
                                </p>
                            }
                            else
                            {
                                <p>
                                    @q.DataField: @q.Value
                                </p>
                            }
                        }
                    }
                    if (model.Entities.Count > 0)
                    {
                        foreach (var e in model.Entities)
                        {
                            <h3>@VezaVIUtils.Plural(e.Name)</h3>
                            for (int i = 1; i <= e.NrOfEntities; i++)
                            {
                                <h5>@e.Name @i</h5>
                                foreach (var q in e.DataFields)
                                {
                                    <p>
                                        @q.Name: @q[i]
                                    </p>
                                }
                            }

                        }
                    }
                    <a target="_blank" href="api/GeneratePDF/@TransactionID" class="btn btn-primary" download="@($"{TransactionID}.pdf")">Download Contract</a>
                }
            </VezaVITab>
            <VezaVITab Caption="Preview">
                <DocumentPreview HistoryID="TransactionID" />
            </VezaVITab>
        </VezaVITabControl>
    </div>
</div>

@code {

    private Guid _transactionID;
    [Parameter]
    public Guid TransactionID
    {
        get
        {
            return _transactionID;
        }
        set
        {
            _transactionID = value;
        }
    }

    private async Task HandleClose()
    {
        NavigationManager.NavigateTo("/");
    }

    QuestionSimulationDisplayModel model;
    protected async override Task OnInitializedAsync()
    {
        model = await SimulationDisplayService.GetByID(_transactionID);
    }

    private async Task Finalize()
    {
        
    }

}
